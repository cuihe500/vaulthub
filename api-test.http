### VaultHub API 测试文件
### 使用说明：
### 1. 首先执行注册和登录接口获取token
### 2. 将获取的token填入下方的 @token 变量
### 3. 将获取的用户UUID填入 @userUuid 变量
### 4. 按顺序执行各个接口测试

### 环境变量配置
@baseUrl = http://localhost:8080
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX3V1aWQiOiI2ZmM2NTA3OS05NmQzLTRmYTItOGJiZi0yY2IwZmIwYWM1NWEiLCJ1c2VybmFtZSI6ImN1aWhlNTAwIiwicm9sZSI6InVzZXIiLCJpc3MiOiJ2YXVsdGh1YiIsImV4cCI6MTc2MjU3MjA1MCwiaWF0IjoxNzYyNDg1NjUwfQ.Civ_Le-eeyg3ocz5YzVVv4iKRI1pfJM4Zf5MDgnGWKw
@userUuid = 6fc65079-96d3-4fa2-8bbf-2cb0fb0ac55a

### ============================================
### 1. 系统接口
### ============================================

### 1.1 健康检查
GET {{baseUrl}}/health
Content-Type: application/json

### ============================================
### 2. 邮件接口
### ============================================

### 2.1 发送注册验证码
POST {{baseUrl}}/api/v1/email/send-code
Content-Type: application/json

{
  "email": "cuihe500@example.com",
  "purpose": "register"
}

### 2.2 发送登录验证码
POST {{baseUrl}}/api/v1/email/send-code
Content-Type: application/json

{
  "email": "cuihe500@example.com",
  "purpose": "login"
}

### 2.3 发送重置密码验证码
POST {{baseUrl}}/api/v1/email/send-code
Content-Type: application/json

{
  "email": "cuihe500@example.com",
  "purpose": "reset_password"
}

### 2.4 验证验证码
POST {{baseUrl}}/api/v1/email/verify-code
Content-Type: application/json

{
  "email": "cuihe500@example.com",
  "code": "123456",
  "purpose": "register"
}

### ============================================
### 3. 认证接口
### ============================================

### 3.1 用户注册（仅用户名密码，不验证邮箱）
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "username": "cuihe500",
  "password": "Ch870219176!"
}

### 3.1.1 用户注册（带邮箱验证）
### 注意：需要先执行 2.1 发送注册验证码，并替换下方的验证码
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "password": "TestPass123!",
  "email": "cuihe500@example.com",
  "code": "123456",
  "nickname": "测试用户"
}

### 3.2 用户登录
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "username": "cuihe500",
  "password": "Ch870219176!"
}

### 3.2.1 邮箱验证码登录
### 注意：需要先执行 2.2 发送登录验证码，并替换下方的验证码
POST {{baseUrl}}/api/v1/auth/login-with-email
Content-Type: application/json

{
  "email": "cuihe500@example.com",
  "code": "123456"
}

### 3.3 获取当前用户信息
GET {{baseUrl}}/api/v1/auth/me
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.4 用户登出
POST {{baseUrl}}/api/v1/auth/logout
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.4.1 获取安全密码设置状态
### 用于前端判断用户是否需要先设置安全密码
GET {{baseUrl}}/api/v1/auth/security-pin-status
Authorization: Bearer {{token}}

### 3.5 使用恢复密钥重置安全密码
### 注意：需要先创建加密密钥（8.1）并保存恢复密钥到@recoveryKey变量
POST {{baseUrl}}/api/v1/auth/reset-password
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "recovery_mnemonic": "{{recoveryKey}}",
  "new_security_pin": "NewSecurityPIN123!"
}

### 3.6 请求密码重置（发送重置邮件）
### 注意：无需认证，会向邮箱发送重置链接
POST {{baseUrl}}/api/v1/auth/request-password-reset
Content-Type: application/json

{
  "email": "cuihe500@example.com",
  "domain": "http://localhost:8080"
}

### 3.7 验证密码重置token
### 注意：将从邮件中获取的token替换下方的{token}
GET {{baseUrl}}/api/v1/auth/verify-reset-token?token={token}
Content-Type: application/json

### 3.8 使用token重置密码
### 注意：将从邮件中获取的token替换下方的{token}
POST {{baseUrl}}/api/v1/auth/reset-password-with-token
Content-Type: application/json

{
  "token": "{token}",
  "new_password": "NewPassword123!"
}

### ============================================
### 4. 用户管理接口（需要管理员权限）
### ============================================

### 3.1 获取用户列表（基本查询）
GET {{baseUrl}}/api/v1/users
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.2 获取用户列表（带分页）
GET {{baseUrl}}/api/v1/users?page=1&page_size=10
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.3 获取用户列表（按状态过滤 - 活跃）
GET {{baseUrl}}/api/v1/users?status=1
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.4 获取用户列表（按状态过滤 - 已禁用）
GET {{baseUrl}}/api/v1/users?status=2
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.5 获取用户列表（按状态过滤 - 已锁定）
GET {{baseUrl}}/api/v1/users?status=3
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.6 获取用户列表（按角色过滤 - 管理员）
GET {{baseUrl}}/api/v1/users?role=admin
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.7 获取用户列表（按角色过滤 - 普通用户）
GET {{baseUrl}}/api/v1/users?role=user
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.8 获取用户列表（按角色过滤 - 只读用户）
GET {{baseUrl}}/api/v1/users?role=readonly
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.9 获取用户列表（复合条件）
GET {{baseUrl}}/api/v1/users?page=1&page_size=20&status=1&role=user
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.10 获取单个用户信息
GET {{baseUrl}}/api/v1/users/{{userUuid}}
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.11 更新用户状态（禁用）
PUT {{baseUrl}}/api/v1/users/{{userUuid}}/status
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "status": 2
}

### 3.12 更新用户状态（锁定）
PUT {{baseUrl}}/api/v1/users/{{userUuid}}/status
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "status": 3
}

### 3.13 更新用户状态（激活）
PUT {{baseUrl}}/api/v1/users/{{userUuid}}/status
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "status": 1
}

### 3.14 更新用户角色（设置为管理员）
PUT {{baseUrl}}/api/v1/users/{{userUuid}}/role
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "role": "admin"
}

### 3.15 更新用户角色（设置为普通用户）
PUT {{baseUrl}}/api/v1/users/{{userUuid}}/role
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "role": "user"
}

### 3.16 更新用户角色（设置为只读用户）
PUT {{baseUrl}}/api/v1/users/{{userUuid}}/role
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "role": "readonly"
}

### ============================================
### 4. 错误测试场景
### ============================================

### 4.1 注册（用户名过短）
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "username": "ab",
  "password": "testpass123456"
}

### 4.2 注册（用户名过长）
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "username": "abcdefghijklmnopqrstuvwxyz1234567",
  "password": "testpass123456"
}

### 4.3 注册（密码过短）
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "password": "short"
}

### 4.4 登录（错误的密码）
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "wrongpassword"
}

### 4.5 登录（不存在的用户）
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "username": "nonexistent",
  "password": "testpass123456"
}

### 4.6 无token访问需要认证的接口
GET {{baseUrl}}/api/v1/auth/me
Content-Type: application/json

### 4.7 无效的token
GET {{baseUrl}}/api/v1/auth/me
Content-Type: application/json
Authorization: Bearer invalid-token

### 4.8 更新用户角色（无效的角色）
PUT {{baseUrl}}/api/v1/users/{{userUuid}}/role
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "role": "superadmin"
}

### 4.9 更新用户状态（无效的状态）
PUT {{baseUrl}}/api/v1/users/{{userUuid}}/status
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "status": 99
}

### 4.10 获取不存在的用户
GET {{baseUrl}}/api/v1/users/non-existent-uuid
Content-Type: application/json
Authorization: Bearer {{token}}

### ============================================
### 5. 用户档案接口
### ============================================

### 5.1 获取当前用户档案信息
GET {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

### 5.2 创建或更新用户档案（再次调用会更新）
PATCH {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "测试用户",
  "phone": "13500135000",
  "email": "patch-updated@example.com"
}

### 5.3 更新用户档案（完整更新）
PUT {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "测试用户2",
  "phone": "13900139000",
  "email": "your_username_here@example.com"
}

### 5.4 更新用户档案（部分更新 - 只更新昵称）
PUT {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "超级管理员"
}

### 5.5 更新用户档案（部分更新 - 只更新手机号）
PUT {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "phone": "13700137000"
}

### 5.6 更新用户档案（部分更新 - 只更新邮箱）
PUT {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "email": "newemail@example.com"
}

### 5.7 创建或更新用户档案（首次调用会创建）
PATCH {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "测试用户",
  "phone": "13600136000",
  "email": "patch@example.com"
}

### 5.8 删除用户档案
DELETE {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

### ============================================
### 6. 管理员用户档案接口（需要管理员权限）
### ============================================

### 6.1 获取用户档案列表（基本查询）
GET {{baseUrl}}/api/v1/admin/profiles
Content-Type: application/json
Authorization: Bearer {{token}}

### 6.2 获取用户档案列表（带分页）
GET {{baseUrl}}/api/v1/admin/profiles?page=1&page_size=10
Content-Type: application/json
Authorization: Bearer {{token}}

### 6.3 获取用户档案列表（按昵称搜索）
GET {{baseUrl}}/api/v1/admin/profiles?nickname=崔
Content-Type: application/json
Authorization: Bearer {{token}}

### 6.4 获取用户档案列表（按邮箱搜索）
GET {{baseUrl}}/api/v1/admin/profiles?email=thankseveryone.top
Content-Type: application/json
Authorization: Bearer {{token}}

### 6.5 获取指定用户档案（使用用户ID）
GET {{baseUrl}}/api/v1/admin/users/1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

### 6.6 更新指定用户档案（管理员为用户更新）
PUT {{baseUrl}}/api/v1/admin/users/1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "管理员修改的昵称",
  "phone": "13400134000",
  "email": "admin@modified.com"
}

### 6.7 更新指定用户档案（管理员只更新昵称）
PUT {{baseUrl}}/api/v1/admin/users/1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "管理员昵称更新"
}

### ============================================
### 7. 用户档案错误测试场景
### ============================================

### 7.1 创建用户档案（昵称为空）
POST {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "",
  "phone": "13800138000",
  "email": "test@example.com"
}

### 7.2 创建用户档案（邮箱为空）
POST {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "测试用户",
  "phone": "13800138000",
  "email": ""
}

### 7.3 创建用户档案（无效的邮箱格式）
POST {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "测试用户",
  "phone": "13800138000",
  "email": "invalid-email"
}

### 7.4 创建用户档案（无效的手机号格式）
POST {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "测试用户",
  "phone": "123456",
  "email": "test@example.com"
}

### 7.5 创建用户档案（昵称过长）
POST {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "这个昵称非常非常长，超过了数据库字段的最大限制长度",
  "phone": "13800138000",
  "email": "test@example.com"
}

### 7.6 创建用户档案（手机号过长）
POST {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "测试用户",
  "phone": "138001380001234567890",
  "email": "test@example.com"
}

### 7.7 创建用户档案（邮箱过长）
POST {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "测试用户",
  "phone": "13800138000",
  "email": "this.email.address.is.very.long.and.exceeds.the.maximum.allowed.length.for.email.fields.in.database.schema"
}

### 7.8 更新用户档案（空的昵称）
PUT {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "",
  "email": "test@example.com"
}

### 7.9 更新用户档案（空的邮箱）
PUT {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nickname": "测试用户",
  "email": ""
}

### 7.10 无token访问用户档案接口
GET {{baseUrl}}/api/v1/profile
Content-Type: application/json

### 7.11 无效token访问用户档案接口
GET {{baseUrl}}/api/v1/profile
Content-Type: application/json
Authorization: Bearer invalid-token

### 7.12 普通用户尝试访问管理员接口
GET {{baseUrl}}/api/v1/admin/profiles
Content-Type: application/json
Authorization: Bearer {{token}}

### 7.13 获取不存在的用户档案
GET {{baseUrl}}/api/v1/admin/users/999999/profile
Content-Type: application/json
Authorization: Bearer {{token}}

### ============================================
### 8. 加密密钥管理接口
### ============================================

### 环境变量（恢复密钥相关）
@recoveryKey = gate green memory orphan pact exist tribe name maple flame business round wagon virus dance raise frost cake erosion teach crowd theme machine dog

### 8.1 创建用户加密密钥（首次使用）
### 警告：返回的恢复密钥（24个单词）仅显示一次，请务必保存到@recoveryKey变量
### 注意：security_pin 是安全密码，用于保护加密数据，独立于登录密码
POST {{baseUrl}}/api/v1/keys/create
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!"
}

### 8.2 验证恢复密钥有效性
### 注意：需要先将8.1返回的recovery_key（24个单词，空格分隔）填入@recoveryKey变量
POST {{baseUrl}}/api/v1/keys/verify-recovery
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "recovery_mnemonic": "{{recoveryKey}}"
}

### 8.3 手动触发密钥轮换
### 注意：密钥轮换会在后台渐进式迁移所有加密数据，每30天最多轮换一次
### security_pin 是安全密码，用于验证和解密DEK
POST {{baseUrl}}/api/v1/keys/rotate
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!"
}

### 8.4 查询密钥轮换进度
### 获取当前用户的密钥轮换状态和数据迁移进度
GET {{baseUrl}}/api/v1/keys/rotation-status
Content-Type: application/json
Authorization: Bearer {{token}}

### ============================================
### 9. 秘密管理接口
### ============================================

### 环境变量（秘密相关）
@secretUuid = e73d61c1-29fd-440d-b9f9-6a3517610e48

### 9.1 创建加密秘密（API密钥）
### 注意：security_pin 是安全密码，用于加密和解密数据
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!",
  "secret_name": "GitHub API Token",
  "secret_type": "api_key",
  "plain_data": "ghp_1234567890abcdefghijklmnopqrstuvwxyz",
  "description": "用于访问GitHub API的个人访问令牌",
  "metadata": {
    "tags": ["github", "api", "production"],
    "extra": {
      "permissions": ["repo", "read:org"]
    }
  }
}

### 9.2 创建加密秘密（数据库凭证）
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!",
  "secret_name": "Production MySQL",
  "secret_type": "db_credential",
  "plain_data": "{\"host\":\"db.example.com\",\"port\":3306,\"username\":\"admin\",\"password\":\"SuperSecret123!\",\"database\":\"production\"}",
  "description": "生产环境MySQL数据库连接信息"
}

### 9.3 创建加密秘密（SSH私钥）
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!",
  "secret_name": "Server SSH Key",
  "secret_type": "ssh_key",
  "plain_data": "-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEA...\n-----END RSA PRIVATE KEY-----",
  "description": "服务器SSH登录私钥"
}

### 9.4 创建加密秘密（密码）
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!",
  "secret_name": "Admin Password",
  "secret_type": "password",
  "plain_data": "AdminP@ssw0rd2024!",
  "description": "系统管理员密码"
}

### 9.5 创建加密秘密（证书）
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!",
  "secret_name": "SSL Certificate",
  "secret_type": "certificate",
  "plain_data": "-----BEGIN CERTIFICATE-----\nMIIDXTCCAkWgAwIB...\n-----END CERTIFICATE-----",
  "description": "域名SSL证书"
}

### 9.6 创建加密秘密（带过期时间）
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!",
  "secret_name": "Temporary Token",
  "secret_type": "token",
  "plain_data": "temp_token_abc123xyz",
  "description": "临时访问令牌",
  "metadata": {
    "expires_at": "2026-12-31T23:59:59Z",
    "tags": ["temporary", "limited"]
  }
}

### 9.7 获取秘密列表（所有秘密）
GET {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

### 9.8 获取秘密列表（带分页）
GET {{baseUrl}}/api/v1/secrets?page=1&page_size=10
Content-Type: application/json
Authorization: Bearer {{token}}

### 9.9 获取秘密列表（按类型过滤 - API密钥）
GET {{baseUrl}}/api/v1/secrets?secret_type=api_key
Content-Type: application/json
Authorization: Bearer {{token}}

### 9.10 获取秘密列表（按类型过滤 - 数据库凭证）
GET {{baseUrl}}/api/v1/secrets?secret_type=db_credential
Content-Type: application/json
Authorization: Bearer {{token}}

### 9.11 获取秘密列表（按类型过滤 - 证书）
GET {{baseUrl}}/api/v1/secrets?secret_type=certificate
Content-Type: application/json
Authorization: Bearer {{token}}

### 9.12 获取秘密列表（按类型过滤 - SSH密钥）
GET {{baseUrl}}/api/v1/secrets?secret_type=ssh_key
Content-Type: application/json
Authorization: Bearer {{token}}

### 9.13 获取秘密列表（按类型过滤 - 令牌）
GET {{baseUrl}}/api/v1/secrets?secret_type=token
Content-Type: application/json
Authorization: Bearer {{token}}

### 9.14 获取秘密列表（按类型过滤 - 密码）
GET {{baseUrl}}/api/v1/secrets?secret_type=password
Content-Type: application/json
Authorization: Bearer {{token}}

### 9.15 解密秘密（获取明文数据）
### 注意：将上面创建秘密返回的secret_uuid填入@secretUuid变量
### security_pin 是安全密码，用于解密数据
POST {{baseUrl}}/api/v1/secrets/{{secretUuid}}/decrypt
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!"
}

### 9.16 删除秘密
DELETE {{baseUrl}}/api/v1/secrets/{{secretUuid}}
Content-Type: application/json
Authorization: Bearer {{token}}

### ============================================
### 10. 秘密管理错误测试场景
### ============================================

### 10.1 创建秘密（未创建加密密钥）
### 注意：使用一个新用户测试此场景
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "TestSecurityPIN123!",
  "secret_name": "Test Secret",
  "secret_type": "password",
  "plain_data": "secret123"
}

### 10.2 创建秘密（安全密码错误）
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "WrongSecurityPIN123!",
  "secret_name": "Test Secret",
  "secret_type": "api_key",
  "plain_data": "test_api_key"
}

### 10.3 创建秘密（秘密名称为空）
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!",
  "secret_name": "",
  "secret_type": "password",
  "plain_data": "secret123"
}

### 10.4 创建秘密（秘密类型无效）
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!",
  "secret_name": "Test Secret",
  "secret_type": "invalid_type",
  "plain_data": "secret123"
}

### 10.5 创建秘密（明文数据为空）
POST {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!",
  "secret_name": "Test Secret",
  "secret_type": "password",
  "plain_data": ""
}

### 10.6 解密秘密（安全密码错误）
POST {{baseUrl}}/api/v1/secrets/{{secretUuid}}/decrypt
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "WrongSecurityPIN123!"
}

### 10.7 解密秘密（UUID不存在）
POST {{baseUrl}}/api/v1/secrets/non-existent-uuid/decrypt
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "password": "your_password_here"
}

### 10.8 删除秘密（UUID不存在）
DELETE {{baseUrl}}/api/v1/secrets/non-existent-uuid
Content-Type: application/json
Authorization: Bearer {{token}}

### 10.9 无token访问秘密接口
GET {{baseUrl}}/api/v1/secrets
Content-Type: application/json

### 10.10 无效token访问秘密接口
GET {{baseUrl}}/api/v1/secrets
Content-Type: application/json
Authorization: Bearer invalid-token

### 10.11 重复创建加密密钥
POST {{baseUrl}}/api/v1/keys/create
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "security_pin": "YourSecurityPIN123!"
}

### ============================================
### 11. 系统配置管理接口（需要管理员权限）
### ============================================

### 11.1 获取所有系统配置
GET {{baseUrl}}/api/v1/configs
Content-Type: application/json
Authorization: Bearer {{token}}

### 11.2 获取单个配置（批次大小）
GET {{baseUrl}}/api/v1/configs/key_rotation_batch_size
Content-Type: application/json
Authorization: Bearer {{token}}

### 11.3 获取单个配置（批次休眠时间）
GET {{baseUrl}}/api/v1/configs/key_rotation_batch_sleep_ms
Content-Type: application/json
Authorization: Bearer {{token}}

### 11.4 获取单个配置（admin初始化标志）
GET {{baseUrl}}/api/v1/configs/admin_initialized
Content-Type: application/json
Authorization: Bearer {{token}}

### 11.5 更新配置（批次大小）
### 注意：配置更新后立即生效，正在运行的密钥轮换任务会在下一批次使用新配置
PUT {{baseUrl}}/api/v1/configs/key_rotation_batch_size
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "config_value": "200"
}

### 11.6 更新配置（批次休眠时间）
PUT {{baseUrl}}/api/v1/configs/key_rotation_batch_sleep_ms
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "config_value": "50"
}

### 11.7 批量更新配置
### 在同一事务中更新多个配置，全部成功或全部失败
PUT {{baseUrl}}/api/v1/configs/batch
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "configs": [
    {
      "config_key": "key_rotation_batch_size",
      "config_value": "150"
    },
    {
      "config_key": "key_rotation_batch_sleep_ms",
      "config_value": "75"
    }
  ]
}

### 11.8 重新加载配置
### 从数据库重新加载所有配置到内存
POST {{baseUrl}}/api/v1/configs/reload
Content-Type: application/json
Authorization: Bearer {{token}}

### ============================================
### 12. 系统配置错误测试场景
### ============================================

### 12.1 获取不存在的配置
GET {{baseUrl}}/api/v1/configs/nonexistent_config_key
Content-Type: application/json
Authorization: Bearer {{token}}

### 12.2 更新不存在的配置
PUT {{baseUrl}}/api/v1/configs/nonexistent_config_key
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "config_value": "some_value"
}

### 12.3 更新配置（值为空）
PUT {{baseUrl}}/api/v1/configs/key_rotation_batch_size
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "config_value": ""
}

### 12.4 批量更新配置（包含不存在的配置键）
PUT {{baseUrl}}/api/v1/configs/batch
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "configs": [
    {
      "config_key": "key_rotation_batch_size",
      "config_value": "100"
    },
    {
      "config_key": "nonexistent_key",
      "config_value": "value"
    }
  ]
}

### 12.5 批量更新配置（空数组）
PUT {{baseUrl}}/api/v1/configs/batch
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "configs": []
}

### 12.6 无token访问系统配置接口
GET {{baseUrl}}/api/v1/configs
Content-Type: application/json

### 12.7 无效token访问系统配置接口
GET {{baseUrl}}/api/v1/configs
Content-Type: application/json
Authorization: Bearer invalid-token

### 12.8 普通用户尝试访问系统配置接口
### 注意：使用普通用户的token测试
GET {{baseUrl}}/api/v1/configs
Content-Type: application/json
Authorization: Bearer {{token}}
